<!-- Fullscreen Modal for Product Detail (Pizza Style) with Owl Carousel -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">

<div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-body d-flex flex-column flex-md-row p-0">

        <!-- Left: Product Image Carousel -->
        <div class="col-md-5 bg-black d-flex align-items-center justify-content-center p-4">
          <div class="owl-carousel owl-theme" id="productImageCarousel"></div>
        </div>

        <!-- Right: Product Info -->
        <div class="col-md-7 p-4">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h4 id="modalName" class="fw-bold mb-1">Product Name</h4>
              <p class="text-muted mb-2">
                <del id="modalOldPrice">Rs. 0</del> <span id="modalPrice" class="fw-bold text-success">Rs. 0</span>
              </p>
              <p class="small text-secondary" id="modalDescription">üçé Fruits & Dry Fruits Store ü•≠</p>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="mt-3">
            <strong>Size</strong>
            <div>
              <div class="form-check">
                <input class="form-check-input size-radio" type="radio" name="size" id="sizeRegular" value="0" checked>
                <label class="form-check-label" for="sizeRegular">KG</label>
              </div>
              <div class="form-check">
                <input class="form-check-input size-radio" type="radio" name="size" id="sizeLarge" value="0">
                <label class="form-check-label" for="sizeLarge">POW</label>
              </div>
            </div>
          </div>

          <div class="mt-3">
            <strong>Choose Your Quantity Level</strong>
            <div id="quantityOptions"></div>
          </div>

          <div class="mt-4 d-flex align-items-center">
            <button class="btn btn-outline-secondary px-3" id="qtyMinus">-</button>
            <input type="text" id="qtyInput" value="1" class="form-control mx-2 text-center" style="width: 60px;">
            <button class="btn btn-outline-secondary px-3" id="qtyPlus">+</button>
          </div>

          <div class="mt-3">
            <h5>Total: <span id="totalPrice" class="text-primary">Rs. 0</span></h5>
          </div>

          <div class="mt-4">
            <button class="btn btn-primary w-100">üõí Add to Cart</button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<script>
  const sizeRadios = document.querySelectorAll('.size-radio');
  const qtyInput = document.getElementById('qtyInput');
  const totalPrice = document.getElementById('totalPrice');
  const qtyMinus = document.getElementById('qtyMinus');
  const qtyPlus = document.getElementById('qtyPlus');

  function updateTotalPrice() {
    const selectedSize = document.querySelector('.size-radio:checked');
    const unitPrice = parseInt(selectedSize.value);
    const quantity = parseInt(qtyInput.value);
    const total = unitPrice * quantity;
    totalPrice.textContent = `Rs. ${total.toFixed(2)}`;
  }

  sizeRadios.forEach(radio => {
    radio.addEventListener('change', updateTotalPrice);
  });

  qtyMinus.addEventListener('click', () => {
    let qty = parseInt(qtyInput.value);
    if (qty > 1) {
      qtyInput.value = qty - 1;
      updateTotalPrice();
    }
  });

  qtyPlus.addEventListener('click', () => {
    let qty = parseInt(qtyInput.value);
    qtyInput.value = qty + 1;
    updateTotalPrice();
  });

  qtyInput.addEventListener('change', updateTotalPrice);

  function generateQuantityOptions(unit) {
    const options = [1, 2, 3];
    const container = document.getElementById('quantityOptions');
    container.innerHTML = '';
    options.forEach(qty => {
      const radio = document.createElement('input');
      const label = document.createElement('label');
      const id = `${unit}${qty}`;

      radio.className = 'form-check-input';
      radio.type = 'radio';
      radio.name = 'quantity';
      radio.id = id;
      radio.value = `${qty} ${unit}`;

      label.className = 'form-check-label';
      label.htmlFor = id;
      label.textContent = `${qty} ${unit}`;

      const wrapper = document.createElement('div');
      wrapper.className = 'form-check';
      wrapper.appendChild(radio);
      wrapper.appendChild(label);

      container.appendChild(wrapper);
    });
  }

  function openCartModal(product) {
    document.getElementById('modalName').textContent = product.name;
    document.getElementById('modalDescription').textContent = `Category: ${product.category}`;
    document.getElementById('modalOldPrice').textContent = `Rs. ${product.price + 100}`;
    document.getElementById('modalPrice').textContent = `Rs. ${product.price}`;
    document.getElementById('sizeRegular').value = product.price;
    document.getElementById('sizeLarge').value = product.price + 250;

    // Replace images in Owl Carousel
    const carousel = $('#productImageCarousel');
    carousel.trigger('replace.owl.carousel', '');
    product.images.forEach(img => {
      carousel.trigger('add.owl.carousel', [`<div class="item"><img src="${img}" class="img-fluid rounded"></div>`]);
    });
    carousel.trigger('refresh.owl.carousel');

    generateQuantityOptions('KG');
    document.getElementById('sizeRegular').addEventListener('change', () => generateQuantityOptions('KG'));
    document.getElementById('sizeLarge').addEventListener('change', () => generateQuantityOptions('POW'));

    updateTotalPrice();
    const cartModal = new bootstrap.Modal(document.getElementById('cartModal'));
    cartModal.show();
  }

  $(document).ready(function(){
    $('#productImageCarousel').owlCarousel({
      items: 1,
      loop: true,
      nav: true,
      dots: true,
      autoplay: true,
      autoplayTimeout: 3000,
      navText: ["<i class='bi bi-chevron-left'></i>", "<i class='bi bi-chevron-right'></i>"]
    });
  });
</script>

<!-- Required Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<style>
  .modal-content {
    border-radius: 20px;
    overflow: hidden;
  }
</style>